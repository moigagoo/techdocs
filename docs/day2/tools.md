# Языки разметки и инструменты документирования

## Языки разметки

Как только появилась письменность, появилась и разметка текста. Бывает, что без разметки текст не прочитать.

![Огласовки в Коране](img/arabian-diacritics.jpg)

Для современного писателя разметка текста — способ сделать текст читабельнее. Выделяя слова и абзацы в общем теле документа, мы управляем вниманием.

Синтаксис HTML или LaTeX громоздок и отвлекает от содержания. Поэтому техписы пишут на так называемый легковесных языках разметки.

Выбрать правильный язык не так просто. Они различаются сложностью и возможностями.

!!! info
    Почему не Ворд? Потому что документация в Ворде не версионируема и не может жить рядом с кодом.


### Markdown

Самый популярный язык, lingua franca в технической коммуникации. Поддерживают все: GitHub, Bitbucket, Slack, Telegram.

Маркдаун должен знать каждый. Простой до примитивности, кривенький и косенький, Маркдаун — пример того, как в историческом соревновании побеждает не совершеннейший, а наиболее приспособленный.

```markdown
# Header

Regular text.

## Subheader

Here's some **bold** and *italic* for you (you can ***combine*** them).

Here's a [link](http://example.com) and an image: ![Alt text](image.png)

Tables are a mess:

| Name    | Age  | Gender |
|---------|------|--------|
| Alice   | 23   | female |
| Bob     | 34   | male   |
| XJ-1234 | 2000 | other  |
```

Плюсы:

-   простота,
-   читается в сыром виде лучше всех,
-   популярность.

Минусы:

-   нет стандарта синтаксиса,
-   нет стандарта и API для расширений,
-   принудительный разрыв строки — это висячий пробел.

Ссылки:

-   [Статья в Вики](https://en.wikipedia.org/wiki/Markdown)
-   [Оригинальная статья о языке](https://daringfireball.net/projects/markdown/)
-   [Commonmark](https://commonmark.org/)
-   [GitHub flavored Markdown](https://github.github.com/gfm/)


### reStructuredText

Старый язык, сейчас популярен в экосистеме Python в связке со [Sphinx](http://www.sphinx-doc.org/). Пересекается с Маркдауном в базовом синтаксисе.

Приятный язык, хотя и со своими закидонами. Главный плюс — возможность расширения синтаксиса. Благодаря этому возможно существование Сфинкса, который добавляет синтаксис для документирования кода.

```restructuredtext
######
Header
######

Unlike in Markdown where the level of a header is exactly the number of # symbols, in reST, header inheritance is calculated on the fly. Sound cool but in fact it eliminates any attempt to implement includes.

*********
Subheader
*********

**Bold** and *italic* are the same as in Markdown. But you ***can't*** combine them :-(

`Links <http://example.com>`_ look weird until you get used to them.

Image:

.. image:: image.png
    :alt: Alt text

.. note:: reST supports admonitions!
    This is called “semantic markup.”

Tables can be the same ugly mess as in Markdown, but there are saner options—csv and list tables:

.. list-table::
   :header-rows: 1

   * - Name
     - Age
     - Gender
   * - Alice
     - 23
     - female
   * - Bob
     - 34
     - male
   * - XJ-1234
     - 2000
     - other
```

Плюсы:

-   почти все простые вещи делаются просто,
-   бо́льшая выразительность, чем у Маркдауна,
-   семантическая вёрстка,
-   есть API для расширений,
-   есть синтаксис для сложных таблиц,
-   Сфинкс.

Минусы:

-   не все простые вещи делаются просто, например, ссылки и картинки,
-   непопулярность,
-   нефиксированная иерархия заголовков.

!!! info
    Семантическая вёрстка — это когда у текста есть роли с независимым слоем представления. В Маркдауне семмантической вёрстки нет: инфоблок — это цитата, а его заглоовок — просто жирный текст. В Ресте — есть: инфоблоки — это роль `.. info::`, которая имеет разное представление в html и pdf.

    Семантическая вёрстка хороша в меру: иногда визуально выделить проще, чем семантически.

Ссылки:

-   [Официальный сайт](http://docutils.sourceforge.net/rst.html)
-   [Статья в Вики](https://en.wikipedia.org/wiki/ReStructuredText)
-   [Справка по языку на сайте Сфинкса](http://sphinx-doc.org/en/latest/usage/restructuredtext/basics.html)


### AsciiDoc

Старый и непопулярный язык, получивший вторую жизнь в экосистеме Ruby в связке с [AsciiDoctor](https://asciidoctor.org). Пересекается с Маркдауном в базовом синтаксисе.

Аскидок — это просто нереальный комбайн, в нём есть всё. Института расширений для него нет, потому что ему они как будто вообще не нужны. По количеству выразительных средств он бьёт всех.

```asciidoc
= Header

Regular paragraph.

== Subheader

Syntax for *bold* and _italic_ is a little different.

https://example.com[Links] are so weird, I can't even.

Image syntax is also, how do I put it, interesting:

image::image.png[Alt text]

NOTE: But the admonition syntax is fire.

Tables can be linearized, with another unconventional syntax construct:

.
|===
|Name
|Age
|Gender

|Alice
|23
|female

|Bob
|34
|male

|XJ-1234
|2000
|other
|===
```

Плюсы:

-   непревзойдённая выразительность,
-   семантическая вёрстка.

Минусы:

-   нет API для расширений,
-   бессистемный синтаксис.

Ссылки:

-   [Официальный сайт](http://www.methods.co.nz/asciidoc/)
-   [Статья в Вики](https://en.wikipedia.org/wiki/AsciiDoc)
-   [Справка по языку на сайте Аскидоктора](https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/)


### Wiki Markup

У каждой вики свой синтаксис, один чудовищнее другого. Включил вики-разметку в список только для честности. Выучивать её нет смысла, потому что он всё равно везде разная. Поэтому же всё равно пользуешься визивигом.


## Инструменты документирования

Сравним несколько инструментов документирования по параметрам:

-   какой язык разметки использует,
-   на чём написан,
-   подходит ли для мануалов,
-   подходит ли для референсов,
-   какие форматы умеет генерировать,
-   насколько легко кастомизировать результат.


### Для мануалов

#### В облаке

**[Confluence](confluence.atlassian.com/).** Наверно, самое популярное решение для компаний.

Плюсы:

-   хорошо работает в Атлассиан-стеке,
-   есть комментарии,
-   разделение прав.

Минусы:

-   чудовищный визивиг,
-   комментарии — так себе,
-   вики-разметка,
-   тормозной,
-   нельзя менять дизайн,
-   оставить ссылку на заголовок — приключение,
-   переместить страницу — приключение,
-   только сайт.

Моё убеждение: Конфлюенсом пользуются только потому, что нет альтернативы.

**[GitBook](https://www.gitbook.com/).** Задуман как сервис для написания книг в Маркдауне. Исходники документации хранятся в репозитории.

Плюсы:

-   Маркдаун,
-   можно писать в любимом редакторе,
-   приятный дизайн.

Минусы:

-   Маркдаун без расширений даёт скудные выразительные средства,
-   нельзя менять дизайн,
-   только сайт. 

**[Google Docs](https://docs.google.com/).** Да, и их используют для документации :-)

Плюсы:

-   лучший визивиг на свете,
-   есть у всех,
-   шаринг и права,
-   богатые выразительные средства,
-   pdf, docx и сайт.

Минусы:

-   нечитабельные УРЛы,
-   нельзя менять дизайн,
-   ни с чем не интегрируется,
-   невозможно организовать документы иерархически.

Гуглодоки часто игнорируют как платформу для документации, а зря. У них чертовски хороший визивиг, поэтому редактирование документации в них однозначно лучше, чем у кого бы то ни было.

Из-за того, что нет нормальной навигации, для референсов их использовать невозможно. Для одного мануала — ОК, для серии — не ОК.

Когда Гугл догадается сделать конкуретна Конфлюенса с визивигом из Доков — это будет бомба.

**[GitHub Wiki](https://guides.github.com/features/wikis/)**.

Плюсы:

-   рядом с репкой,
-   бесплатно,
-   Маркдаун,
-   есть навигация.

Минусы:

-   поиск неудобный, потому что ищет не только по вики,
-   неудобный дизайн, который нельзя менять,
-   Маркдаун без расширений,
-   редактирование только на сайте,
-   только сайт,
-   неявные соглашения о названиях файлов.

Сейчас даже сам Гитхаб, кажется, забил на вики и больше пиарит Джекил. Преимуществ у вики перед статическим сайтом нет.


#### Self-hosted

**[Jekyll](https://jekyllrb.com/).** Самый популярный генератор статических сайтов. Позиционируется как решение в первую очередь для блогов.

Плюсы:

-   интеграция с Гитхабом, превращающая его в облачное решение,
-   Маркдаун,
-   много готовых дизайнов, можно делать свой,
-   поиск и навигация.

Минусы:

-   Руби,
-   сложная структура папок,
-   Маркдаун без расширений,
-   по-нормальному — только сайт.

**[MkDocs](https://www.mkdocs.org/).** В отличие от Джекила, создавался в первую очередь для документации, как альтернатива Сфинксу. Почти идеальный.

Плюсы:

-   Маркдаун с расширениями,
-   есть готовые дизайны, можно делать свои,
-   хорошая документация,
-   поиск и навигация.

Минусы:

-   по-нормальному — только сайт,
-   заголовки на русском — боль.

Отличное решение для мануалов и для писаных вручную референсов. В него можно засунуть даже сгенерированные референсы, потому что используется гибкий диалект Маркдауна.

**[Sphinx](http://www.sphinx-doc.org/).** Генератор документации в первую очередь для Питона. Сразу задумывался и для мануалов, и для референсов и и для сайтов, и для pdf. Почти идеальный.

Плюсы:

-   богатый синтаксис,
-   персистентные кроссссылки,
-   генерирует API-документацию из кода на Питоне, Яве, ЖС, Го и много ещё каких языков,
-   можно оставлять ссылки на сущности кода,
-   генерирует pdf и сайт,
-   есть готовые темы, можно делать свои (и для pdf тоже),
-   поиск и навигация.

Минусы:

-   не Маркдаун,
-   мало хороших тем,
-   переусложнённый API расширений.

Сфинкс уникален по сочетанию фич. Но нужны ли вам все его фичи — вопрос.

**[AsciiDoctor](https://asciidoctor.org/).** Генератор скорее страниц, чем документации. Конвертирует один файл в другой файл.

Плюсы:

-   хорошая тема,
-   генерирует сайт и pdf.

Минусы:

-   нет поиска и навигации,
-   не умеет работать с папками,
-   тем нет вообще,
-   Руби.

Если честно, для полноценной документации он не годится: конвертировать файлики по одному и склеивать их потом скриптом — так себе история.

**[Pandoc](https://pandoc.org/).** Конвертер из всего во всё. Строго говоря, это не генератор документации, хоть и может так использоваться.

Плюсы:

-   удобные шаблоны для pdf,
-   генерирует всё,
-   Маркдаун с клёвыми расширениями.

Минусы:

-   конвертирует файл в файл.

Для полноценной документации ещё хуже, чем Аскидоктор. Зато его можно использовать как бекенд для другого генератора.

**[Foliant](https://foliant-docs.github.io/docs/).** (Минутка бессовестного пиара :-) Фолиант создавался как конкурент Сфинкса на Маркдауне. Имеет модульную архитектуру: всё интересное происходит в расширениях, а ядро выступает клеем.

Плюсы:

-   Маркдаун с синтаксисом для расширений тегами,
-   инклюды,
-   генерирует сайт, pdf, docx, заливает в Гугл.
-   для сайта использует Макдокс, для остального — Пандок,
-   просто писать расширения.

Минусы:

-   нет расширения для универсальных кроссссылок,
-   разрабатывается небольшой группой людей,

### Для референсов

**[Swagger](https://swagger.io/).** Инструмент для описания REST API. Свагер — это две вещи: спецификация и конвертер из документов в этой спецификации в html.

Спецификация нечитабельна и неписабельна. Например, вместо Маркдауна или другого общеизвестного языка используется какая-то своя вики-разметка, а неудачно поставленная точка в конце строки может разнести всю документацию: точка есть, это brief, нет — description.

Конвертер делает сайтик, на котором можно пострелять реальными запросами по апихе — и это единственная его полезная функция. Сайтик нельзя кастомизировать, а других инструментов, работающих с этой спекой, нет.

Плюсы:

-   популярный, если это можно считать плюсом.

Минусы:

-   неудобная и сложная спецификация,
-   сгенерированный сайт не встроить в другую документацию,
-   только сайт,
-   поправить опечатку — приключение, потому что сайт полностью оторван от кода,
-   как продукт, Свагер пропагандирует подход «код первичен, документация вторична», что аукается быстро и болезненно.

**[RAML](https://raml.org/).** Те же яйца, только в профиль.

**[apiDoc](http://apidocjs.com/).** Тоже инструмент для документирования REST API. Заточен под использование в комментариях в коде.

Плюсы:

-   Маркдаун,
-   спецификация проще, чем у Свагера,
-   переиспользовать файл проще, чем у Свагера,
-   хорошо генерируется из кода.

**[API Blueprint](https://apiblueprint.org/).** Инструмент для документирования REST API в отрыве от кода вообще. Идеология — «спецификация первична, код — вторичен», что уже перебор.

Но как инструмент для описания абстрактной API-спецификации он прекрасен: это обычный Маркдаун, который красиво рендерится.

Плюсы:

-   Маркдаун *и всё*,
-   много инструментов, поддерживающих стандарт.

Минусы:

-   не генерируется из кода.

**[Sphinx](http://www.sphinx-doc.org/).** В Сфинксе есть понятие [доменов](www.sphinx-doc.org/en/latest/usage/restructuredtext/domains.html). Домен — это набор ролей для документирования кода на каком-то языке. Из коробки доступны: Python, JS, C, C++, reST, Math, Standard. Из пакетов ставятся другие языки. Есть и [домен для REST API](https://sphinxcontrib-httpdomain.readthedocs.io/en/stable/).

Домены позволяют писать удобную API-документацию вручную. Но Сфинкс ещё и генерирует документацию из кода: на Питоне — из коробки, Go, .NET, JS, Python — через [Sphinx AutoAPI](https://sphinx-autoapi.readthedocs.io/), на Java — через [javasphinx](https://bronto.github.io/javasphinx/). Даже REST API можно генерировать из кода, правда, только из приложений на Flask, Bottle и Tornado.

Плюсы:

-   встраивается в существующую документацию на Сфинксе,
-   генерируется из кода на многих языках,
-   годится не только для REST API,
-   кроссссылки на код.

Минусы:

-   не Маркдаун,
-   генерации кода для вашего языка может не быть,
-   проект Sphinx AutoAPI молодой,
-   при генерации доков из кода на Питоне код импортируется.

**[Doxygen](http://www.doxygen.nl/).** Изначально генератор документации из кода на C++, сейчас поддерживает и другие языки.

Плюсы:

-   старое, проверенное решение,
-   поддерживает много языков.

Минусы:

-   уродский дизайн из 90-х,
-   уродский язык разметки,
-   не подходит для документирования REST API,
-   не подходит для ручного документирования,
-   только сайт.


### Прочее

Документация — это необязательно сайтик или документ. Кроме Readme, о котором следующее занятие, есть совсем альтернативные подходы. Расскажу об одном, который меня зацепил.

[Компания Etsy разделила документацию на why docs и how docs](https://codeascraft.com/2018/10/10/etsys-experiment-with-immutable-documentation/). Первые меняются редко, их они ведут как обычную документацию. Вторые меняются постоянно, и их с сайта перенесли в Слак. Одна команда добавляет статью в хранилище, другая — ищет по добавленным статьям.

В качестве эксперимента я сделал приложения для Слака и поставил его в своей команде. Выглядит это так. Пишешь в чат: «/как зайти на прод такого-то сервиса?». «/как» — это команда, которая ищет по запросу в базе знаний. Чтобы добавить ответ, пишешь: «/так зайти на прод такого-то сервиса» или «/вот как зайти на прод такого-то сервиса». Ответы с высоким рейтингом показываются выше, среди равных приоритет у свежих.

Скажу честно: пользуемся мало, но всё равно прикольно. Попробуйте! Экспериментируйте!
